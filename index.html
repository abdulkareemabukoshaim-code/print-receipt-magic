<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Receipt Generator Pro - Create Professional Receipts</title>
  <meta name="description" content="Professional receipt generator with multiple styles, QR codes, and PDF export. Perfect for businesses, retail stores, restaurants and more.">
  <meta name="author" content="Receipt Generator Pro">

  <meta property="og:title" content="Receipt Generator Pro - Create Professional Receipts">
  <meta property="og:description" content="Professional receipt generator with multiple styles, QR codes, and PDF export. Perfect for businesses, retail stores, restaurants and more.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lovable_dev">
  <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png">

  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /* Receipt Generator Design System - Premium Colors & Gradients */
    :root {
      --background: 240 10% 3.9%;
      --foreground: 0 0% 98%;
      --card: 240 10% 3.9%;
      --card-foreground: 0 0% 98%;
      --primary: 262 83% 58%;
      --primary-foreground: 210 40% 98%;
      --secondary: 240 3.7% 15.9%;
      --secondary-foreground: 0 0% 98%;
      --muted: 240 3.7% 15.9%;
      --muted-foreground: 240 5% 64.9%;
      --accent: 240 3.7% 15.9%;
      --accent-foreground: 0 0% 98%;
      --destructive: 0 62.8% 30.6%;
      --destructive-foreground: 0 0% 98%;
      --border: 240 3.7% 15.9%;
      --input: 240 3.7% 15.9%;
      --ring: 262 83% 58%;
      --success: 142 71% 45%;
      --warning: 38 92% 50%;
      --info: 199 89% 48%;
      --gradient-primary: linear-gradient(135deg, hsl(262 83% 58%), hsl(199 89% 48%));
      --gradient-success: linear-gradient(135deg, hsl(142 71% 45%), hsl(142 71% 35%));
      --gradient-receipt: linear-gradient(180deg, hsl(0 0% 100%), hsl(0 0% 98%));
      --shadow-receipt: 0 20px 25px -5px hsl(0 0% 0% / 0.1), 0 10px 10px -5px hsl(0 0% 0% / 0.04);
      --shadow-glow: 0 0 40px hsl(262 83% 58% / 0.3);
      --radius: 0.75rem;
    }

    .light {
      --background: 0 0% 100%;
      --foreground: 222.2 84% 4.9%;
      --card: 0 0% 100%;
      --card-foreground: 222.2 84% 4.9%;
      --primary: 262 83% 58%;
      --primary-foreground: 210 40% 98%;
      --secondary: 210 40% 96.1%;
      --secondary-foreground: 222.2 47.4% 11.2%;
      --muted: 210 40% 96.1%;
      --muted-foreground: 215.4 16.3% 46.9%;
      --accent: 210 40% 96.1%;
      --accent-foreground: 222.2 47.4% 11.2%;
      --destructive: 0 84.2% 60.2%;
      --destructive-foreground: 210 40% 98%;
      --border: 214.3 31.8% 91.4%;
      --input: 214.3 31.8% 91.4%;
      --ring: 262 83% 58%;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: hsl(var(--background));
      color: hsl(var(--foreground));
      min-height: 100vh;
      line-height: 1.5;
    }

    .light {
      color-scheme: light;
    }

    .light body {
      background: hsl(var(--background));
      color: hsl(var(--foreground));
    }

    /* Utility Classes */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .grid {
      display: grid;
    }

    .grid-cols-1 {
      grid-template-columns: repeat(1, minmax(0, 1fr));
    }

    .grid-cols-2 {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .grid-cols-3 {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }

    .gap-4 {
      gap: 1rem;
    }

    .gap-8 {
      gap: 2rem;
    }

    .space-y-2 > * + * {
      margin-top: 0.5rem;
    }

    .space-y-4 > * + * {
      margin-top: 1rem;
    }

    .flex {
      display: flex;
    }

    .items-center {
      align-items: center;
    }

    .justify-between {
      justify-content: space-between;
    }

    .justify-center {
      justify-content: center;
    }

    .text-center {
      text-align: center;
    }

    .mb-2 {
      margin-bottom: 0.5rem;
    }

    .mb-3 {
      margin-bottom: 0.75rem;
    }

    .mb-8 {
      margin-bottom: 2rem;
    }

    .mt-2 {
      margin-top: 0.5rem;
    }

    .mt-3 {
      margin-top: 0.75rem;
    }

    .p-4 {
      padding: 1rem;
    }

    .pt-4 {
      padding-top: 1rem;
    }

    .px-4 {
      padding-left: 1rem;
      padding-right: 1rem;
    }

    .py-1 {
      padding-top: 0.25rem;
      padding-bottom: 0.25rem;
    }

    .w-full {
      width: 100%;
    }

    .min-h-screen {
      min-height: 100vh;
    }

    .text-xs {
      font-size: 0.75rem;
    }

    .text-sm {
      font-size: 0.875rem;
    }

    .text-lg {
      font-size: 1.125rem;
    }

    .text-4xl {
      font-size: 2.25rem;
    }

    .font-bold {
      font-weight: 700;
    }

    .font-black {
      font-weight: 900;
    }

    .font-medium {
      font-weight: 500;
    }

    .font-mono {
      font-family: 'Courier New', monospace;
    }

    .font-sans {
      font-family: 'Inter', system-ui, sans-serif;
    }

    .font-serif {
      font-family: 'Times New Roman', serif;
    }

    .leading-tight {
      line-height: 1.25;
    }

    .rounded {
      border-radius: 0.25rem;
    }

    .rounded-lg {
      border-radius: var(--radius);
    }

    .border {
      border-width: 1px;
    }

    .border-2 {
      border-width: 2px;
    }

    .border-t {
      border-top-width: 1px;
    }

    .border-b-2 {
      border-bottom-width: 2px;
    }

    .border-dashed {
      border-style: dashed;
    }

    .bg-gradient-primary {
      background: var(--gradient-primary);
    }

    .bg-clip-text {
      background-clip: text;
      -webkit-background-clip: text;
    }

    .text-transparent {
      color: transparent;
    }

    /* Card Styles */
    .card {
      background: hsl(var(--card));
      color: hsl(var(--card-foreground));
      border-radius: var(--radius);
      border: 1px solid hsl(var(--border));
      box-shadow: var(--shadow-receipt);
    }

    .card-header {
      padding: 1.5rem 1.5rem 0;
    }

    .card-content {
      padding: 1.5rem;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      line-height: 1;
    }

    /* Form Styles */
    .label {
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      display: block;
    }

    .input, .textarea, .select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid hsl(var(--border));
      border-radius: calc(var(--radius) - 2px);
      background: hsl(var(--background));
      color: hsl(var(--foreground));
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .input:focus, .textarea:focus, .select:focus {
      outline: none;
      border-color: hsl(var(--ring));
      box-shadow: 0 0 0 3px hsl(var(--ring) / 0.1);
    }

    .textarea {
      min-height: 80px;
      resize: vertical;
    }

    .select {
      cursor: pointer;
    }

    .checkbox {
      width: 1rem;
      height: 1rem;
      margin-right: 0.5rem;
    }

    /* Button Styles */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: calc(var(--radius) - 2px);
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
      border: none;
      text-decoration: none;
    }

    .btn-primary {
      background: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
    }

    .btn-primary:hover {
      background: hsl(var(--primary) / 0.9);
      box-shadow: var(--shadow-glow);
    }

    .btn-secondary {
      background: hsl(var(--secondary));
      color: hsl(var(--secondary-foreground));
    }

    .btn-secondary:hover {
      background: hsl(var(--secondary) / 0.8);
    }

    .btn-destructive {
      background: hsl(var(--destructive));
      color: hsl(var(--destructive-foreground));
    }

    .btn-destructive:hover {
      background: hsl(var(--destructive) / 0.9);
    }

    .btn-sm {
      padding: 0.25rem 0.75rem;
      font-size: 0.75rem;
    }

    /* Receipt Styles */
    .receipt-container {
      background: white;
      color: black;
      width: 80mm;
      min-height: 200px;
      margin: 0 auto;
      padding: 1rem;
      font-size: 0.75rem;
      line-height: 1.25;
      box-shadow: var(--shadow-receipt);
    }

    .receipt-thermal {
      font-family: 'Courier New', monospace;
      border: 1px solid #ccc;
    }

    .receipt-modern {
      font-family: 'Inter', system-ui, sans-serif;
      border-radius: var(--radius);
    }

    .receipt-corporate {
      font-family: 'Inter', system-ui, sans-serif;
      border: 2px solid #1a1a1a;
    }

    .receipt-retail {
      font-family: 'Inter', system-ui, sans-serif;
      border: 1px solid #666;
    }

    .receipt-restaurant {
      font-family: 'Times New Roman', serif;
      border: 1px solid #555;
    }

    .receipt-pharmacy {
      font-family: 'Inter', system-ui, sans-serif;
      border: 2px solid #3b82f6;
      background: #eff6ff;
    }

    .receipt-grocery {
      font-family: 'Inter', system-ui, sans-serif;
      border: 1px solid #22c55e;
      background: #f0fdf4;
    }

    .receipt-gas {
      font-family: 'Courier New', monospace;
      border: 2px solid #eab308;
      background: #fefce8;
    }

    .receipt-coffee {
      font-family: 'Inter', system-ui, sans-serif;
      border: 2px solid #d97706;
      background: #fffbeb;
    }

    .receipt-tech {
      font-family: 'Inter', system-ui, sans-serif;
      border: 2px solid #a855f7;
      background: #faf5ff;
    }

    .separator {
      height: 1px;
      background: #e5e7eb;
      margin: 0.5rem 0;
    }

    .header-pharmacy {
      text-align: center;
      font-weight: bold;
      color: #1e40af;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #3b82f6;
    }

    .header-grocery {
      text-align: center;
      font-weight: bold;
      color: #166534;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #22c55e;
    }

    .header-gas {
      text-align: center;
      font-weight: bold;
      color: #a16207;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #eab308;
      background: #fef3c7;
      margin: -1rem -1rem 0.5rem -1rem;
      padding: 1rem 1rem 0.5rem 1rem;
    }

    .header-coffee {
      text-align: center;
      font-weight: bold;
      color: #92400e;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #d97706;
      background: #fed7aa;
      margin: -1rem -1rem 0.5rem -1rem;
      padding: 1rem 1rem 0.5rem 1rem;
    }

    .header-tech {
      text-align: center;
      font-weight: bold;
      color: #7c3aed;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #a855f7;
      background: #e9d5ff;
      margin: -1rem -1rem 0.5rem -1rem;
      padding: 1rem 1rem 0.5rem 1rem;
    }

    .header-restaurant {
      text-align: center;
      font-weight: bold;
      color: #374151;
      font-size: 1rem;
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #374151;
    }

    .header-corporate {
      text-align: center;
      font-weight: bold;
      color: #111827;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #374151;
    }

    .header-default {
      text-align: center;
      font-weight: bold;
      color: #111827;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }

    /* Print Styles */
    .no-print {
      display: block;
    }

    @media print {
      .no-print {
        display: none !important;
      }

      body {
        background: white !important;
        color: black !important;
        margin: 0 !important;
        padding: 0 !important;
      }

      .receipt-container {
        width: 80mm !important;
        max-width: 80mm !important;
        margin: 0 !important;
        padding: 8mm !important;
        box-shadow: none !important;
        border: none !important;
        break-inside: avoid;
      }

      .card {
        box-shadow: none !important;
        border: none !important;
        background: transparent !important;
      }

      .card-header, .card-content {
        padding: 0 !important;
      }
    }

    /* Responsive */
    @media (min-width: 1024px) {
      .lg\\:grid-cols-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (min-width: 768px) {
      .md\\:grid-cols-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .md\\:grid-cols-3 {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    /* Toast notification styles */
    .toast {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: hsl(var(--card));
      color: hsl(var(--card-foreground));
      padding: 0.75rem 1rem;
      border-radius: var(--radius);
      border: 1px solid hsl(var(--border));
      box-shadow: var(--shadow-receipt);
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }

    .toast.success {
      border-color: hsl(var(--success));
      background: hsl(var(--success) / 0.1);
    }

    .toast.error {
      border-color: hsl(var(--destructive));
      background: hsl(var(--destructive) / 0.1);
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Light mode toggle */
    .light body {
      background: hsl(var(--background));
      color: hsl(var(--foreground));
    }

    .light .card {
      background: hsl(var(--card));
      color: hsl(var(--card-foreground));
      border-color: hsl(var(--border));
    }

    .light .input, .light .textarea, .light .select {
      background: hsl(var(--background));
      color: hsl(var(--foreground));
      border-color: hsl(var(--border));
    }
  </style>
</head>

<body class="light">
  <div class="min-h-screen p-4">
    <div class="container">
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold bg-gradient-primary bg-clip-text text-transparent mb-2">
          Receipt Generator Pro
        </h1>
        <p style="color: hsl(var(--muted-foreground));">Create professional receipts with multiple styles</p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Form Panel -->
        <div class="card no-print">
          <div class="card-header">
            <h2 class="card-title flex items-center gap-4">
              📄 Receipt Details
            </h2>
          </div>
          <div class="card-content space-y-4">
            <!-- Store Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="label" for="storeName">Store Name</label>
                <input class="input" id="storeName" placeholder="My Store">
              </div>
              <div>
                <label class="label" for="storeAddress">Store Address</label>
                <input class="input" id="storeAddress" placeholder="123 Main St, City, State">
              </div>
              <div>
                <label class="label" for="storePhone">Phone Number</label>
                <input class="input" id="storePhone" placeholder="(555) 123-4567">
              </div>
              <div>
                <label class="label" for="storeEmail">Email</label>
                <input class="input" id="storeEmail" placeholder="store@example.com">
              </div>
            </div>

            <!-- Transaction Details -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="label" for="date">Date & Time</label>
                <input class="input" id="date">
              </div>
              <div>
                <label class="label" for="transactionId">Transaction ID</label>
                <input class="input" id="transactionId">
              </div>
              <div>
                <label class="label" for="cashier">Cashier</label>
                <input class="input" id="cashier" placeholder="John Doe">
              </div>
              <div>
                <label class="label" for="paymentMethod">Payment Method</label>
                <input class="input" id="paymentMethod" placeholder="Cash">
              </div>
            </div>

            <!-- Items -->
            <div>
              <label class="label" for="items">Items (Format: Item Name - Price)</label>
              <textarea class="textarea" id="items" placeholder="Apple - 2.00&#10;Banana - 1.50&#10;Orange - 3.00" rows="4"></textarea>
              <button class="btn btn-secondary w-full mt-2" onclick="addItems()">Add Items</button>
            </div>

            <!-- Current Items -->
            <div id="currentItems" style="display: none;">
              <label class="label">Current Items</label>
              <div id="itemsList" class="space-y-2 mt-2"></div>
            </div>

            <!-- Totals -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="label" for="subtotal">Subtotal</label>
                <input class="input" id="subtotal" placeholder="10.00">
              </div>
              <div>
                <label class="label" for="tax">Tax</label>
                <input class="input" id="tax" placeholder="0.80">
              </div>
              <div>
                <label class="label" for="total">Total</label>
                <input class="input" id="total" placeholder="10.80">
              </div>
            </div>

            <!-- Style Selection -->
            <div>
              <label class="label" for="style">Receipt Style</label>
              <select class="select" id="style">
                <option value="modern">Modern Clean</option>
                <option value="thermal">Thermal Printer</option>
                <option value="corporate">Corporate Business</option>
                <option value="retail">Retail Store</option>
                <option value="restaurant">Restaurant</option>
                <option value="pharmacy">Pharmacy</option>
                <option value="grocery">Grocery Store</option>
                <option value="gas">Gas Station</option>
                <option value="coffee">Coffee Shop</option>
                <option value="tech">Electronics Store</option>
              </select>
            </div>

            <!-- Options -->
            <div class="space-y-2">
              <label class="label">Options</label>
              <div class="grid grid-cols-2 gap-4">
                <div class="flex items-center">
                  <input type="checkbox" class="checkbox" id="includeQR" checked>
                  <label for="includeQR">Include QR Code</label>
                </div>
                <div class="flex items-center">
                  <input type="checkbox" class="checkbox" id="includeTerms">
                  <label for="includeTerms">Include Terms</label>
                </div>
                <div class="flex items-center">
                  <input type="checkbox" class="checkbox" id="includeContact" checked>
                  <label for="includeContact">Include Contact Info</label>
                </div>
                <div class="flex items-center">
                  <input type="checkbox" class="checkbox" id="includeLogo" checked>
                  <label for="includeLogo">Include Store Header</label>
                </div>
              </div>
            </div>

            <!-- Footer & Terms -->
            <div>
              <label class="label" for="footerMessage">Footer Message</label>
              <textarea class="textarea" id="footerMessage" placeholder="Thank you for your business!" rows="2"></textarea>
            </div>

            <div id="termsSection" style="display: none;">
              <label class="label" for="terms">Terms & Conditions</label>
              <textarea class="textarea" id="terms" placeholder="All sales final. Returns within 30 days with receipt." rows="3"></textarea>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4 pt-4">
              <button class="btn btn-primary flex-1" onclick="handlePrint()">
                🖨️ Print Receipt
              </button>
              <button class="btn btn-secondary flex-1" onclick="handleDownloadPDF()">
                📥 Download PDF
              </button>
            </div>
          </div>
        </div>

        <!-- Receipt Preview -->
        <div class="receipt-preview">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Receipt Preview</h2>
            </div>
            <div class="card-content">
              <div id="receiptContainer">
                <!-- Receipt will be generated here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize default values
    let receiptData = {
      storeName: '',
      storeAddress: '',
      storePhone: '',
      storeEmail: '',
      date: new Date().toLocaleString(),
      transactionId: 'TXN' + Math.random().toString(36).substr(2, 9).toUpperCase(),
      items: [],
      subtotal: '',
      tax: '',
      total: '',
      paymentMethod: 'Cash',
      cashier: '',
      footerMessage: 'Thank you for your business!',
      terms: '',
      style: 'modern'
    };

    let options = {
      includeQR: true,
      includeTerms: false,
      includeContact: true,
      includeLogo: true
    };

    // Initialize form
    function initializeForm() {
      document.getElementById('date').value = receiptData.date;
      document.getElementById('transactionId').value = receiptData.transactionId;
      document.getElementById('paymentMethod').value = receiptData.paymentMethod;
      document.getElementById('footerMessage').value = receiptData.footerMessage;
      
      // Add event listeners
      document.getElementById('includeTerms').addEventListener('change', function() {
        const termsSection = document.getElementById('termsSection');
        termsSection.style.display = this.checked ? 'block' : 'none';
        options.includeTerms = this.checked;
        generateReceipt();
      });

      // Add event listeners for all inputs
      const inputs = ['storeName', 'storeAddress', 'storePhone', 'storeEmail', 'date', 'transactionId', 'cashier', 'paymentMethod', 'subtotal', 'tax', 'total', 'footerMessage', 'terms'];
      inputs.forEach(id => {
        document.getElementById(id).addEventListener('input', function() {
          receiptData[id] = this.value;
          generateReceipt();
        });
      });

      document.getElementById('style').addEventListener('change', function() {
        receiptData.style = this.value;
        generateReceipt();
      });

      const checkboxes = ['includeQR', 'includeTerms', 'includeContact', 'includeLogo'];
      checkboxes.forEach(id => {
        document.getElementById(id).addEventListener('change', function() {
          options[id] = this.checked;
          if (id === 'includeTerms') {
            document.getElementById('termsSection').style.display = this.checked ? 'block' : 'none';
          }
          generateReceipt();
        });
      });

      // Generate initial receipt
      generateReceipt();
    }

    function addItems() {
      const itemInput = document.getElementById('items').value;
      if (!itemInput.trim()) return;

      const newItems = itemInput.split('\n').filter(line => line.trim()).map(line => {
        const parts = line.split('-').map(part => part.trim());
        return {
          name: parts[0] || '',
          price: parts[1] || '0.00',
          quantity: 1
        };
      });

      receiptData.items = [...receiptData.items, ...newItems];
      document.getElementById('items').value = '';
      updateItemsList();
      generateReceipt();
      showToast(`Added ${newItems.length} item(s) to receipt`, 'success');
    }

    function removeItem(index) {
      receiptData.items = receiptData.items.filter((_, i) => i !== index);
      updateItemsList();
      generateReceipt();
    }

    function updateItemsList() {
      const currentItems = document.getElementById('currentItems');
      const itemsList = document.getElementById('itemsList');
      
      if (receiptData.items.length > 0) {
        currentItems.style.display = 'block';
        itemsList.innerHTML = receiptData.items.map((item, index) => `
          <div class="flex justify-between items-center" style="background: hsl(var(--muted)); padding: 0.5rem; border-radius: 0.25rem;">
            <span>${item.name} - $${item.price}</span>
            <button class="btn btn-destructive btn-sm" onclick="removeItem(${index})">Remove</button>
          </div>
        `).join('');
      } else {
        currentItems.style.display = 'none';
      }
    }

    function generateReceipt() {
      const container = document.getElementById('receiptContainer');
      
      // Get receipt style classes
      let receiptClass = 'receipt-container';
      switch (receiptData.style) {
        case 'thermal':
          receiptClass += ' receipt-thermal font-mono border';
          break;
        case 'modern':
          receiptClass += ' receipt-modern font-sans rounded-lg';
          break;
        case 'corporate':
          receiptClass += ' receipt-corporate font-sans';
          break;
        case 'retail':
          receiptClass += ' receipt-retail font-sans';
          break;
        case 'restaurant':
          receiptClass += ' receipt-restaurant font-serif';
          break;
        case 'pharmacy':
          receiptClass += ' receipt-pharmacy font-sans';
          break;
        case 'grocery':
          receiptClass += ' receipt-grocery font-sans';
          break;
        case 'gas':
          receiptClass += ' receipt-gas font-mono';
          break;
        case 'coffee':
          receiptClass += ' receipt-coffee font-sans';
          break;
        case 'tech':
          receiptClass += ' receipt-tech font-sans';
          break;
        default:
          receiptClass += ' receipt-modern font-sans';
      }

      // Generate brand header
      function getBrandHeader() {
        if (!options.includeLogo || !receiptData.storeName) return '';

        const brandMap = {
          pharmacy: "🏥 PHARMACY & MEDICAL",
          grocery: "🛒 FRESH GROCERIES",
          gas: "⛽ FUEL & CONVENIENCE",
          coffee: "☕ ARTISAN COFFEE",
          tech: "📱 ELECTRONICS & TECH",
          restaurant: "🍽️ FINE DINING",
        };

        let headerClass = 'header-default';
        switch (receiptData.style) {
          case 'pharmacy':
            headerClass = 'header-pharmacy';
            break;
          case 'grocery':
            headerClass = 'header-grocery';
            break;
          case 'gas':
            headerClass = 'header-gas';
            break;
          case 'coffee':
            headerClass = 'header-coffee';
            break;
          case 'tech':
            headerClass = 'header-tech';
            break;
          case 'restaurant':
            headerClass = 'header-restaurant';
            break;
          case 'corporate':
            headerClass = 'header-corporate';
            break;
        }

        return `
          <div class="${headerClass}">
            <div class="text-lg font-black">${receiptData.storeName}</div>
            ${brandMap[receiptData.style] ? `<div class="text-xs mt-1">${brandMap[receiptData.style]}</div>` : ''}
          </div>
        `;
      }

      let receiptHTML = `
        <div class="${receiptClass}">
          ${getBrandHeader()}
          
          <!-- Store Information -->
          <div class="text-center mb-3">
            ${!options.includeLogo && receiptData.storeName ? `<div class="font-bold text-sm mb-1">${receiptData.storeName}</div>` : ''}
            ${receiptData.storeAddress ? `<div class="text-xs">${receiptData.storeAddress}</div>` : ''}
            ${options.includeContact ? `
              ${receiptData.storePhone ? `<div class="text-xs">${receiptData.storePhone}</div>` : ''}
              ${receiptData.storeEmail ? `<div class="text-xs">${receiptData.storeEmail}</div>` : ''}
            ` : ''}
          </div>

          <div class="separator"></div>

          <!-- Transaction Details -->
          <div class="mb-3 space-y-1">
            <div class="flex justify-between">
              <span>Date:</span>
              <span>${receiptData.date}</span>
            </div>
            <div class="flex justify-between">
              <span>Transaction ID:</span>
              <span>${receiptData.transactionId}</span>
            </div>
            ${receiptData.cashier ? `
              <div class="flex justify-between">
                <span>Cashier:</span>
                <span>${receiptData.cashier}</span>
              </div>
            ` : ''}
          </div>

          <div class="separator"></div>

          <!-- Items -->
          ${receiptData.items.length > 0 ? `
            <div class="mb-3">
              ${receiptData.items.map(item => `
                <div class="flex justify-between items-start py-1">
                  <div style="flex: 1; padding-right: 0.5rem;">
                    <div class="font-medium">${item.name}</div>
                    ${item.quantity > 1 ? `<div class="text-xs" style="color: #6b7280;">Qty: ${item.quantity}</div>` : ''}
                  </div>
                  <div class="font-mono">$${item.price}</div>
                </div>
              `).join('')}
            </div>
            <div class="separator"></div>
          ` : ''}

          <!-- Totals -->
          <div class="mb-3 space-y-1">
            ${receiptData.subtotal ? `
              <div class="flex justify-between">
                <span>Subtotal:</span>
                <span class="font-mono">$${receiptData.subtotal}</span>
              </div>
            ` : ''}
            ${receiptData.tax ? `
              <div class="flex justify-between">
                <span>Tax:</span>
                <span class="font-mono">$${receiptData.tax}</span>
              </div>
            ` : ''}
            <div class="flex justify-between font-bold text-sm" style="border-top: 1px solid #e5e7eb; padding-top: 0.25rem;">
              <span>TOTAL:</span>
              <span class="font-mono">$${receiptData.total || '0.00'}</span>
            </div>
            <div class="flex justify-between">
              <span>Payment:</span>
              <span>${receiptData.paymentMethod}</span>
            </div>
          </div>

          <div class="separator"></div>

          <!-- Footer Message -->
          ${receiptData.footerMessage ? `
            <div class="text-center mb-3 text-xs">
              ${receiptData.footerMessage}
            </div>
          ` : ''}

          <!-- Terms & Conditions -->
          ${options.includeTerms && receiptData.terms ? `
            <div class="text-xs mb-3" style="color: #6b7280; border-top: 1px solid #e5e7eb; padding-top: 0.5rem;">
              <div class="font-semibold mb-1">Terms & Conditions:</div>
              <div>${receiptData.terms}</div>
            </div>
          ` : ''}

          <!-- QR Code -->
          ${options.includeQR ? `
            <div class="text-center mt-3">
              <div id="qrcode" style="display: inline-block;"></div>
              <div class="text-xs mt-1" style="color: #6b7280;">Scan for details</div>
            </div>
          ` : ''}

          <!-- Style-specific footer -->
          ${receiptData.style === 'thermal' ? `
            <div class="text-center text-xs mt-3" style="border-top: 1px dashed #000; padding-top: 0.5rem;">
              ** CUSTOMER COPY **
            </div>
          ` : ''}
        </div>
      `;

      container.innerHTML = receiptHTML;

      // Generate QR code
      if (options.includeQR && window.QRCode) {
        const qrContainer = document.getElementById('qrcode');
        if (qrContainer) {
          qrContainer.innerHTML = '';
          const qrText = `${receiptData.storeName}\\n${receiptData.storeAddress}\\n${receiptData.date}\\nTransaction: ${receiptData.transactionId}\\nTotal: $${receiptData.total}`;
          new QRCode(qrContainer, {
            text: qrText,
            width: 80,
            height: 80,
            margin: 1
          });
        }
      }
    }

    function handlePrint() {
      const receiptContainer = document.getElementById('receiptContainer');
      if (!receiptContainer) return;

      const printWindow = window.open('', '_blank');
      if (printWindow) {
        printWindow.document.write(`
          <html>
            <head>
              <title>Receipt</title>
              <style>
                body { 
                  margin: 0; 
                  padding: 0; 
                  font-family: Arial, sans-serif; 
                  background: white;
                  color: black;
                }
                .receipt-container { 
                  width: 80mm; 
                  max-width: 80mm; 
                  margin: 0 auto; 
                  padding: 8mm;
                  box-sizing: border-box;
                }
                .separator {
                  height: 1px;
                  background: #000;
                  margin: 0.5rem 0;
                }
                .font-mono { font-family: 'Courier New', monospace; }
                .font-bold { font-weight: bold; }
                .font-medium { font-weight: 500; }
                .text-xs { font-size: 0.75rem; }
                .text-sm { font-size: 0.875rem; }
                .text-lg { font-size: 1.125rem; }
                .text-center { text-align: center; }
                .flex { display: flex; }
                .justify-between { justify-content: space-between; }
                .items-start { align-items: flex-start; }
                .mb-1 { margin-bottom: 0.25rem; }
                .mb-3 { margin-bottom: 0.75rem; }
                .mt-1 { margin-top: 0.25rem; }
                .mt-3 { margin-top: 0.75rem; }
                .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
                .space-y-1 > * + * { margin-top: 0.25rem; }
                @media print {
                  body { margin: 0; padding: 0; }
                  .receipt-container { 
                    width: 80mm !important; 
                    max-width: 80mm !important; 
                    margin: 0 !important; 
                    padding: 8mm !important;
                  }
                }
              </style>
            </head>
            <body>
              ${receiptContainer.innerHTML}
            </body>
          </html>
        `);
        printWindow.document.close();
        printWindow.print();
        printWindow.close();
        
        showToast('Receipt sent to printer', 'success');
      }
    }

    async function handleDownloadPDF() {
      const receiptContainer = document.getElementById('receiptContainer');
      if (!receiptContainer || !window.html2canvas || !window.jsPDF) {
        showToast('PDF libraries not loaded', 'error');
        return;
      }

      try {
        showToast('Generating PDF...', 'success');
        
        // Create canvas from HTML element with exact receipt dimensions
        const canvas = await html2canvas(receiptContainer.querySelector('.receipt-container'), {
          scale: 3,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#ffffff',
          width: 302, // 80mm in pixels at 96 DPI
          height: undefined // Let height be determined by content
        });

        // Calculate dimensions for receipt (80mm width)
        const imgWidth = 80; // 80mm
        const imgHeight = (canvas.height * imgWidth) / canvas.width;

        // Create PDF with exact receipt dimensions
        const pdf = new jsPDF.jsPDF({
          orientation: 'portrait',
          unit: 'mm',
          format: [imgWidth, imgHeight], // Custom format matching receipt size
        });

        // Add image to PDF
        const imgData = canvas.toDataURL('image/png');
        pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);

        // Save PDF
        pdf.save(`receipt-${receiptData.transactionId}.pdf`);
        showToast('PDF downloaded successfully', 'success');
      } catch (error) {
        console.error('Error generating PDF:', error);
        showToast('Failed to generate PDF', 'error');
      }
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      initializeForm();
    });
  </script>
</body>
</html>